workflows:
  ios-workflow:
    name: "iOS Workflow"
    environment:
      flutter: stable
      xcode: latest

    scripts:
      - name: "Precache & Install Pods"
        script: |
          flutter precache --ios
          flutter pub get
          cd ios
          pod install
          cd ..

      - name: "Build iOS Release"
        script: |
          flutter build ipa --release

    artifacts:
      - build/ios/ipa/*.ipa

    # This is where you configure app-store publishing
    publishing:
      app_store_connect:
        apple_id: $APPLE_ID        # from your environment or codemagic secret
        team_id: $TEAM_ID          # from your environment or codemagic secret
        bundle_id: "com.ragtag.ragtag"
        export_method: app-store
        # submit_to_testflight: true   # uncomment if you want to auto-submit
        # upload_dsyms: true          # uncomment if you want to upload dSYMs

    # Automatic code-signing section
    automatic_code_signing:
      apple_team_id: $TEAM_ID    # from your environment or codemagic secret
      sign_apps: true
